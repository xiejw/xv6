EVA_PATH        = ../eva
EVA_LIB         = ${EVA_PATH}/.build_release/libeva.a

include ${EVA_PATH}/eva.mk

# ------------------------------------------------------------------------------
# configurations.
# ------------------------------------------------------------------------------

XV6             =  xv6
SRC             =  ${XV6}
CMD             =  cmd
FMT_FOLDERS     =  ${XV6} ${CMD}

CFLAGS          += -I${EVA_PATH}/src
LDFLAGS         += ${EVA_LIB}

# ------------------------------------------------------------------------------
# libs.
# ------------------------------------------------------------------------------
XV6_LIB         = ${BUILD}/xv6_emulator.o

ALL_LIBS        = ${XV6_LIB}

# ------------------------------------------------------------------------------
# actions.
# ------------------------------------------------------------------------------

.DEFAULT_GOAL   = xv6

compile: ${BUILD} ${ALL_LIBS}

${BUILD}/xv6_%.o: ${XV6}/%.c
	${EVA_CC} -o $@ -c $<

# ------------------------------------------------------------------------------
# cmd.
# ------------------------------------------------------------------------------

.PNONY: xv6

xv6: compile ${BUILD}/xv6
	${EVA_EX} ${BUILD}/xv6

${BUILD}/xv6: cmd/xv6/main.c ${XV6_LIB}
	${EVA_LD} -o $@ $^
